<!doctype html>
<html lang="ja">

<head>
    Â 
    <link rel="icon" type="image/png" href="https://x.com/yeah_hi0525/status/2012856884806754465/photo/1">
    <link rel="shortcut icon" type="image/png" href="https://x.com/yeah_hi0525/status/2012856884806754465/photo/1">
    <link rel="apple-touch-icon" href="https://x.com/yeah_hi0525/status/2012856884806754465/photo/1">
    <meta charset="utf-8" />
    Â 
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    Â  <title>ã‚½ãƒ¼ãƒˆä»˜ãTODO</title>
    Â  <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans JP', sans-serif;
            margin: 24px;
            background: #f7f8fb
        }

        .wrap {
            max-width: 720px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(30, 30, 60, 0.06)
        }

        h1 {
            margin: 0 0 12px;
            font-size: 20px
        }

        h2 {
            margin: 24px 0 12px;
            font-size: 18px;
            border-bottom: 2px solid #eee;
            padding-bottom: 4px;
        }

        .input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap
        }

        input[type=text],
        input[type=datetime-local] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px
        }

        button {
            padding: 8px 12px;
            border-radius: 8px;
            border: 0;
            background: #2563eb;
            color: #fff;
            cursor: pointer
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 0
        }

        li {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-bottom: 1px solid #f0f2f6;
            flex-wrap: wrap
        }

        li .txt {
            flex: 1
        }

        .small {
            font-size: 12px;
            color: #666
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap
        }

        .muted {
            background: #eee;
            color: #333
        }

        .date-label {
            font-size: 12px;
            color: #888;
            margin-left: 8px;
        }

        .guide {
            background: #f0f4ff;
            border-left: 4px solid #2563eb;
            padding: 10px 14px;
            margin-bottom: 16px;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.6;
        }

        #bulk-controls-main,
        #bulk-controls-asap {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }

        /* ASAPã‚¾ãƒ¼ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·èª¿ */
        .asap-task {
            background-color: #fff9e6;
        }

        .asap-input {
            border-color: #ffc107;
        }
    </style>
</head>

<body>
    Â  <div class="wrap">
        Â  Â  <h1>ã‚½ãƒ¼ãƒˆä»˜ãTODO</h1>

        Â  Â  Â  Â  <div class="guide">
            Â  Â  Â  <strong>ä½¿ã„æ–¹ï¼š</strong>
            Â  Â  Â  <ul style="margin:6px 0 0 16px;">
                Â  Â  Â  Â  <li><b>ASAPã‚¾ãƒ¼ãƒ³ï¼š</b> æœ€å„ªå…ˆã‚¿ã‚¹ã‚¯ã€‚ç· åˆ‡ã¯è¨­å®šã§ãã¾ã›ã‚“ã€‚</li>
                Â  Â  Â  Â  <li><b>ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆï¼š</b> é€šå¸¸ã®ã‚¿ã‚¹ã‚¯ã€‚ç· åˆ‡æ—¥æ™‚ã‚’è¨­å®šå¯èƒ½ã€‚</li>
                Â  Â  Â  Â  <li>ã‚¿ã‚¹ã‚¯ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ã€‚</li>
                Â  Â  Â  </ul>
            Â  Â  </div>

        Â  Â  Â  Â  <h2>ğŸ”¥ ASAPã‚¾ãƒ¼ãƒ³</h2>
        Â  Â  Â  Â  <div class="input-row">
            Â  Â  Â  <input id="asap-input" type="text" placeholder="ASAPã§ã‚„ã‚‹ã“ã¨ã‚’å…¥åŠ›" class="asap-input" />
            Â  Â  Â  Â  Â  Â  <button id="add-asap-btn">è¿½åŠ </button>
            Â  Â  </div>
        Â  Â  Â  Â  <div id="bulk-controls-asap">
            Â  Â  Â  <input type="checkbox" id="select-all-asap"> <label for="select-all-asap">å…¨é¸æŠ</label>
            Â  Â  Â  <button id="delete-selected-asap" class="muted">âœ” ASAPã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤</button>
            Â  Â  </div>
        Â  Â  Â  Â  <ul id="list-asap"></ul>


        Â  Â  Â  Â  <h2>âœ… ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆ</h2>
        Â  Â  Â  Â  <div class="input-row">
            Â  Â  Â  <input id="todo-input" type="text" placeholder="ã‚„ã‚‹ã“ã¨ã‚’å…¥åŠ›" />
            Â  Â  Â  <input id="todo-date" type="datetime-local" style="max-width:180px;" />
            Â  Â  Â  <button id="add-btn">è¿½åŠ </button>
            Â  Â  </div>
        Â  Â  Â  Â  <div id="bulk-controls-main">
            Â  Â  Â  <input type="checkbox" id="select-all-main"> <label for="select-all-main">å…¨é¸æŠ</label>
            Â  Â  Â  <button id="delete-selected-main" class="muted">âœ” ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤</button>
            Â  Â  </div>
        Â  Â  Â  Â  <ul id="list-main"></ul>

        Â  Â 
        <hr>

        Â  Â  Â  Â  <div class="controls">
            Â  Â  Â  <button id="export-btn" class="muted">JSONã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            Â  Â  Â  <button id="import-btn" class="muted">JSONã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            Â  Â  Â  <button id="save-fsa" class="muted">ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ï¼ˆFile System Accessï¼‰</button>
            Â  Â  Â  <input id="file-input" type="file" accept="application/json" style="display:none" />
            Â  Â  </div>

        Â  Â  <p class="small">
            Â  Â  Â  è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã® <code>localStorage</code> ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
            Â  Â  </p>
        Â 
    </div>

    Â 
    <script>
        const STORAGE_KEY = 'local_todo_asap_v1';
        let todos = [];
        let asapTodos = [];

        const input = document.getElementById('todo-input');
        const dateInput = document.getElementById('todo-date');
        const addBtn = document.getElementById('add-btn');
        const listMainEl = document.getElementById('list-main');

        const asapInput = document.getElementById('asap-input');
        const addAsapBtn = document.getElementById('add-asap-btn');
        const listAsapEl = document.getElementById('list-asap');

        const selectAllMain = document.getElementById('select-all-main');
        const deleteSelectedMain = document.getElementById('delete-selected-main');
        const selectAllAsap = document.getElementById('select-all-asap');
        const deleteSelectedAsap = document.getElementById('delete-selected-asap');

        const exportBtn = document.getElementById('export-btn');
        const importBtn = document.getElementById('import-btn');
        const fileInput = document.getElementById('file-input');
        const saveFsaBtn = document.getElementById('save-fsa');
        let fileHandle = null;

        function saveToLocalStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({ todos, asapTodos }));
        }

        function loadFromLocalStorage() {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) return;
            try {
                const data = JSON.parse(raw);
                if (Array.isArray(data.todos)) todos = data.todos;
                if (Array.isArray(data.asapTodos)) asapTodos = data.asapTodos;
            } catch {
                todos = []; asapTodos = [];
            }
        }

        // ã‚¿ã‚¹ã‚¯æç”»ã®å…±é€šé–¢æ•°
        function createTaskElement(t, index, listType) {
            const li = document.createElement('li');
            if (listType === 'asap') li.classList.add('asap-task');

            const chkMain = document.createElement('input');
            chkMain.type = 'checkbox'; chkMain.className = `select-task-${listType}`; chkMain.dataset.index = index;

            const done = document.createElement('input');
            done.type = 'checkbox'; done.checked = !!t.done;
            done.addEventListener('change', () => {
                const list = listType === 'main' ? todos : asapTodos;
                list[index].done = done.checked;
                saveToLocalStorage();
                render();
            });

            const span = document.createElement('span');
            span.className = 'txt'; span.textContent = t.text;
            if (t.done) span.style.textDecoration = 'line-through';

            if (listType === 'main' && t.date) { // ASAPã‚¾ãƒ¼ãƒ³ã§ã¯æ—¥ä»˜ã‚’è¡¨ç¤ºã—ãªã„
                const dateLabel = document.createElement('span');
                dateLabel.className = 'date-label';
                // ğŸ“… æ—¥ä»˜ã‚’ãƒ­ãƒ¼ã‚«ãƒ«æ™‚é–“ã§è¡¨ç¤ºï¼†æ›œæ—¥ã‚’è¿½åŠ 
                const d = new Date(t.date);
                const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
                const wd = weekdays[d.getDay()];
                const y = d.getFullYear();
                const m = d.getMonth() + 1;
                const day = d.getDate();
                const hh = String(d.getHours()).padStart(2, '0');
                const mm = String(d.getMinutes()).padStart(2, '0');
                dateLabel.textContent = `æœŸé™:${y}/${m}/${day}(${wd}) ${hh}:${mm}`;
                li.appendChild(dateLabel);
            }

            const edit = document.createElement('button');
            edit.textContent = 'ç·¨é›†'; edit.className = 'muted';
            edit.addEventListener('click', () => {
                const list = listType === 'main' ? todos : asapTodos;
                const v = prompt('ç·¨é›†ã—ã¦ãã ã•ã„', t.text);
                if (v !== null) { list[index].text = v.trim(); saveToLocalStorage(); render(); }
            });

            const del = document.createElement('button');
            del.textContent = 'å‰Šé™¤'; del.className = 'muted';
            del.addEventListener('click', () => {
                if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    const list = listType === 'main' ? todos : asapTodos;
                    list.splice(index, 1);
                    saveToLocalStorage(); render();
                }
            });

            li.prepend(chkMain, done, span);
            li.append(edit, del);
            return li;
        }

        function render() {
            // ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆã®æç”»
            listMainEl.innerHTML = '';
            // ç· åˆ‡æ—¥ã§ã‚½ãƒ¼ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆï¼‰
            todos.sort((a, b) => {
                // dateãŒãªã„ã‚‚ã®ã¯æœ€å¾Œã«
                if (!a.date && !b.date) return (a.createdAt || '').localeCompare(b.createdAt || '');
                if (!a.date) return 1;
                if (!b.date) return -1;
                return a.date.localeCompare(b.date);
            });
            todos.forEach((t, i) => {
                listMainEl.appendChild(createTaskElement(t, i, 'main'));
            });

            // ASAPãƒªã‚¹ãƒˆã®æç”»
            listAsapEl.innerHTML = '';
            // ä½œæˆæ—¥ã§ã‚½ãƒ¼ãƒˆï¼ˆASAPãƒªã‚¹ãƒˆï¼‰
            asapTodos.sort((a, b) => (a.createdAt || '').localeCompare(b.createdAt || ''));
            asapTodos.forEach((t, i) => {
                listAsapEl.appendChild(createTaskElement(t, i, 'asap'));
            });
        }

        // dateå¼•æ•°ã¯ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆç”¨ã€‚ASAPãƒªã‚¹ãƒˆã®å ´åˆã¯nullã‚’æ¸¡ã™
        function addTodo(text, date, listType) {
            text = text.trim(); if (!text) return;
            const newList = {
                text, done: false, createdAt: new Date().toISOString(),
                date: date || null
            };

            if (listType === 'main') {
                todos.push(newList);
            } else {
                asapTodos.push(newList);
            }

            saveToLocalStorage();
            render();
        }

        // ãƒ¡ã‚¤ãƒ³ãƒªã‚¹ãƒˆã®è¿½åŠ 
        addBtn.addEventListener('click', () => {
            addTodo(input.value, dateInput.value, 'main');
            input.value = ''; dateInput.value = '';
        });

        // ASAPãƒªã‚¹ãƒˆã®è¿½åŠ 
        addAsapBtn.addEventListener('click', () => {
            addTodo(asapInput.value, null, 'asap'); // dateã«ã¯nullã‚’æ¸¡ã™
            asapInput.value = '';
        });


        // âœ… ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ (ãƒ¡ã‚¤ãƒ³)
        selectAllMain.addEventListener('change', () => {
            const checks = [...document.querySelectorAll('.select-task-main')];
            checks.forEach(c => c.checked = selectAllMain.checked);
        });

        deleteSelectedMain.addEventListener('click', () => {
            const checks = [...document.querySelectorAll('.select-task-main:checked')];
            if (checks.length === 0) return alert('å‰Šé™¤ã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚');
            if (!confirm(`${checks.length}ä»¶ã®ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            const indices = checks.map(c => Number(c.dataset.index)).sort((a, b) => b - a);
            indices.forEach(i => todos.splice(i, 1));
            saveToLocalStorage(); render();
        });

        // âœ… ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ (ASAP)
        selectAllAsap.addEventListener('change', () => {
            const checks = [...document.querySelectorAll('.select-task-asap')];
            checks.forEach(c => c.checked = selectAllAsap.checked);
        });

        deleteSelectedAsap.addEventListener('click', () => {
            const checks = [...document.querySelectorAll('.select-task-asap:checked')];
            if (checks.length === 0) return alert('å‰Šé™¤ã™ã‚‹ASAPã‚¿ã‚¹ã‚¯ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚');
            if (!confirm(`${checks.length}ä»¶ã®ASAPã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            const indices = checks.map(c => Number(c.dataset.index)).sort((a, b) => b - a);
            indices.forEach(i => asapTodos.splice(i, 1));
            saveToLocalStorage(); render();
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ (ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/FSA)
        exportBtn.addEventListener('click', () => {
            const allData = { todos, asapTodos };
            if (allData.todos.length === 0 && allData.asapTodos.length === 0) return alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'todos_asap.json'; a.click();
            URL.revokeObjectURL(url);
        });

        importBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', async ev => {
            const f = ev.target.files[0]; if (!f) return;
            try {
                const txt = await f.text();
                const parsed = JSON.parse(txt);
                if (typeof parsed !== 'object' || parsed === null || (!Array.isArray(parsed.todos) && !Array.isArray(parsed.asapTodos))) throw new Error('ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒä¸æ­£ã§ã™');

                if (confirm('è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ä¸Šæ›¸ãã—ã¾ã™ã€‚')) {
                    if (Array.isArray(parsed.todos)) todos = todos.concat(parsed.todos);
                    if (Array.isArray(parsed.asapTodos)) asapTodos = asapTodos.concat(parsed.asapTodos);
                } else {
                    if (Array.isArray(parsed.todos)) todos = parsed.todos;
                    if (Array.isArray(parsed.asapTodos)) asapTodos = parsed.asapTodos;
                    else { todos = []; asapTodos = []; }
                }
                saveToLocalStorage(); render();
            } catch (err) { alert('èª­ã¿è¾¼ã¿å¤±æ•—:' + err.message); }
            fileInput.value = '';
        });

        saveFsaBtn.addEventListener('click', async () => {
            if (!('showSaveFilePicker' in window)) { alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éå¯¾å¿œ'); return; }
            try {
                if (!fileHandle) {
                    fileHandle = await window.showSaveFilePicker({ suggestedName: 'todos_asap.json', types: [{ description: 'JSON', accept: { 'application/json': ['.json'] } }] });
                }
                const writable = await fileHandle.createWritable();
                await writable.write(JSON.stringify({ todos, asapTodos }, null, 2));
                await writable.close(); alert('ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (e) { if (e.name !== 'AbortError') console.error(e); }
        });

        loadFromLocalStorage(); render();
    </script>
</body>
<!--
ä»Šå¾Œã®è¿½åŠ è¦ç´ 
-Enterã§è¿½åŠ 
-æœŸé™åˆ‡ã‚Œã®ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
-ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´
-ç·¨é›†æ©Ÿèƒ½ã§æ—¥ä»˜ã‚‚å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«
-èª²é¡Œã®è©³ç´°ã‚’æ›¸ãè¾¼ã‚ã‚‹ã‚ˆã†ã«
-èª²é¡Œã®é€²æ—ã‚’ãƒãƒ¼ã§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«
-ASPSã‚’è‡ªç”±ã«ä¸¦ã¹æ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«
    -->

</html>